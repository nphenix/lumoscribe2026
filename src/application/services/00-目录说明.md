# application/services 目录说明

> 应用层服务层：存放业务逻辑服务（Service Layer），编排仓储与领域逻辑。
>
> 最后更新：2026-01-29

## 文件列表

| 文件 | 用途 | 更新日期 |
|------|------|----------|
| `__init__.py` | Python 包标记 | 2026-01-16 |
| `source_file_service.py` | SourceFile 服务实现（文件来源业务逻辑） | 2026-01-16 |
| `template_service.py` | Template 服务实现（模板业务逻辑） | 2026-01-16 |
| `intermediate_artifact_service.py` | IntermediateArtifact 服务实现（中间产物业务逻辑） | 2026-01-16 |
| `target_file_service.py` | TargetFile 服务实现（目标文件业务逻辑） | 2026-01-16 |
| `llm_provider_service.py` | LLMProvider 服务实现（模型供应商配置） | 2026-01-16 |
| `llm_capability_service.py` | LLMCapability 服务实现（能力到 Provider 映射管理） | 2026-01-16 |
| `llm_call_site_service.py` | LLMCallSite 服务实现（调用点到 Provider 配置管理） | 2026-01-17 |
| `prompt_service.py` | Prompt 服务实现（提示词版本管理） | 2026-01-16 |
| `llm_runtime_service.py` | LLM 运行时封装（能力选型 + Runnable 构建） | 2026-01-18 |
| `mineru_service.py` | MinerU 服务实现（PDF OCR 与结构化摄入） | 2026-01-16 |
| `document_cleaning_service.py` | 文档清洗与图表提取服务（规则过滤 + LLM 清洗）T031-T032 | 2026-01-18 |
| `document_cleaning/` | Document Cleaning 模块组件（如 prompts） | 2026-01-17 |
| `content_generation/` | Content Generation 模块组件（如 prompts/callsites） | 2026-01-18 |
| `content_generation_service.py` | 内容生成服务导出层（真实实现已拆分至 `content_generation/`）T042 | 2026-01-27 |
| `vector_storage/` | Vector Storage 模块组件（如 callsites） | 2026-01-17 |
| `hybrid_search/` | Hybrid Search 模块组件（如 callsites） | 2026-01-17 |
| `mineru/` | MinerU 模块组件（如 callsites） | 2026-01-17 |
| `chunking_service.py` | 文档切分服务（基于 LlamaIndex 的分层切分）T033 | 2026-01-21 |
| `vector_storage_service.py` | 向量存储服务（ChromaDB 向量存储）T034 | 2026-01-21 |
| `hybrid_search_service.py` | 混合检索服务（BM25 + Vector + RRF）T035 | 2026-01-21 |
| `knowledge_base_service.py` | 知识库构建与查询编排服务（基于 T094 产物建库；hybrid+rerank 查询）T095 | 2026-01-21 |
| `bm25_index_service.py` | BM25 预建索引服务（建库阶段生成；查询阶段加载）T095 | 2026-01-21 |
| `antv_rendering/` | AntV 图表预渲染模块（chart_json -> SVG/PNG）阶段3 | 2026-01-29 |

## 更新日志

| 日期 | 操作 | 文件 | 说明 |
|------|------|------|------|
| 2026-01-27 | 修改 | `content_generation_service.py` | 将内容生成服务拆分到 `content_generation/`，保留此文件为兼容导出层 |
| 2026-01-21 | 新增 | `knowledge_base_service.py` | 新增知识库构建与查询编排服务（T095） |
| 2026-01-21 | 修改 | `chunking_service.py` | `source_file_id` 统一为 UUID 字符串，修复结构切分链路 |
| 2026-01-21 | 修改 | `vector_storage_service.py` | 支持注入 embedding 模型（T023），兼容 Chroma NotFoundError，并优化批量向量写入 |
| 2026-01-21 | 修改 | `hybrid_search_service.py` | 重排序改为注入 reranker（T023），并统一 `source_file_id` 为字符串 |
| 2026-01-21 | 新增 | `bm25_index_service.py` | 新增 BM25 预建索引（持久化 + 查询加载），替代查询时动态构建 |
| 2026-01-21 | 修改 | `llm_runtime_service.py` | FlagEmbedding embedding 跨版本兼容与归一化；device 配置容错（gpu->cuda） |
| 2026-01-29 | 新增 | `antv_rendering/` | 新增 AntV 图表预渲染模块（阶段3） |
| 2026-01-18 | 修改 | `document_cleaning_service.py` | 修复中间产物保存逻辑；LLM 清洗支持 strict 模式 |
| 2026-01-18 | 修改 | `llm_runtime_service.py` | 支持 flagembedding 的 embedding_model_path、rerank_model_path 配置项 |
| 2026-01-18 | 修改 | `content_generation_service.py` | 新增大纲润色功能（polish_outline 方法） |
| 2026-01-18 | 修改 | `content_generation/` | 新增大纲润色调用点和提示词 |
| 2026-01-17 | 新增 | `document_cleaning/` | 提示词重构：添加模块化目录 |
| 2026-01-17 | 新增 | `content_generation/` | 添加内容生成模块化目录（prompts/callsites） |
| 2026-01-17 | 新增 | `vector_storage/` | 添加向量化调用点种子目录 |
| 2026-01-17 | 新增 | `hybrid_search/` | 添加重排序调用点种子目录 |
| 2026-01-17 | 新增 | `mineru/` | 添加 MinerU OCR/解析调用点种子目录 |
| 2026-01-17 | 新增 | `llm_call_site_service.py` | 添加调用点服务 |
| 2026-01-16 | 新增 | `__init__.py` | 初始化 services 包 |
| 2026-01-16 | 新增 | `source_file_service.py` | 添加文件来源服务 |
| 2026-01-16 | 新增 | `template_service.py` | 添加模板服务 |
| 2026-01-16 | 新增 | `intermediate_artifact_service.py` | 添加中间产物服务 |
| 2026-01-16 | 新增 | `target_file_service.py` | 添加目标文件服务 |
| 2026-01-16 | 新增 | `llm_provider_service.py` | 添加模型供应商服务 |
| 2026-01-16 | 新增 | `llm_model_service.py` | 添加模型服务 |
| 2026-01-16 | 新增 | `llm_capability_service.py` | 添加能力映射服务 |
| 2026-01-18 | 删除 | `llm_model_service.py` | 移除 Model 层，CallSite 和 Capability 直接绑定 Provider |
| 2026-01-16 | 新增 | `prompt_service.py` | 添加提示词服务 |
| 2026-01-16 | 新增 | `llm_runtime_service.py` | 添加 LLM 运行时封装 |
| 2026-01-16 | 新增 | `mineru_service.py` | 添加 MinerU 服务 |
| 2026-01-16 | 新增 | `chunking_service.py` | 添加文档切分服务（T033） |
| 2026-01-16 | 新增 | `vector_storage_service.py` | 添加向量存储服务（T034） |
| 2026-01-16 | 新增 | `hybrid_search_service.py` | 添加混合检索服务（T035） |
| 2026-01-16 | 新增 | `document_cleaning_service.py` | 添加文档清洗与图表提取服务（T031-T032） |
